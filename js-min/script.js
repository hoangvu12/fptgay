let animeId,episode,title,latestEpisode;const fptplay=new FPTPlay;var player=videojs("my_video_1",{autoplay:!0,controlBar:{children:{playToggle:{},volumePanel:{inline:!0},previousEpisode:{},nextEpisode:{},ProgressControl:{},RemainingTimeDisplay:{},fullscreenToggle:{}}}});player.ready(function(){this.hotkeys({seekStep:10})}),player.on("error",function(){console.log("Player error:",player.error()),loadPlayer()}),player.on("timeupdate",function(){let a;a=localStorage[animeId]?JSON.parse(localStorage[animeId]):{},episode||(episode=1);const b=player.currentTime();let c=+episode;for(let b in a)+b>=c&&(c=+b);a.latest=c+"",a[episode]={time:b},localStorage[animeId]=JSON.stringify(a)});function onLoadedMetadata(){const a=JSON.parse(localStorage[animeId]);let b;if(!episode){const c=a.latest;b=a[c].time}else b="episode"in a&&"time"in a[episode]?a[episode].time:0;var c=b.toString().split(".")[0];player.currentTime(c)}function loadEpisodes(){const a=document.querySelector(".episodes-list");removeChild(a);for(let b=1;b<=latestEpisode;b++){const c=document.createElement("div"),d=document.createElement("button");c.className="episode-button",c.dataset.episode=b,d.className="episode",d.innerText=`Tập ${b}`,addChildren(c,[d]),a.appendChild(c)}}async function loadPlayer(){localStorage[animeId].includes("latest")&&!episode?episode=JSON.parse(localStorage[animeId]).latest:!episode&&(episode=1),updateInfo(),document.querySelector(".wrapper").style.display="block";const a=await fptplay.getVideoSource({id:animeId,episode});player.src({src:a,type:"application/x-mpegURL"}),player.maxQualitySelector({defaultQuality:2}),onLoadedMetadata()}function updateInfo(){const a=document.querySelector(".current .title"),b=document.querySelector(".current .episode"),c=document.querySelector(`div[data-episode="${episode}"] button`);c||console.log(`div[data-episode="${episode}"] button`),document.querySelector(".episodes-list").querySelectorAll("*").forEach(a=>a.style.color="white"),c.style.color="#f5740a",b.dataset.episode=episode,b.innerText=`Tập ${episode}`,a.innerText=title}async function search(){const a=document.querySelector(".search-results"),b=document.querySelector("#animeName").value;removeChild(a);const c=await fptplay.search(b);c.forEach(({_id:b,title:c,thumb:d,duration:e,episode_latest:f})=>{const g=document.createElement("div"),h=document.createElement("img"),i=document.createElement("div"),j=document.createElement("div");g.className="anime-item",h.className="anime-thumbnail",i.className="anime-title info",j.className="anime-views info",g.dataset.latestEpisode=f,g.dataset.id=b,h.src=d,i.innerText=c,j.innerText=e,addChildren(g,[h,i,j]),a.appendChild(g)})}